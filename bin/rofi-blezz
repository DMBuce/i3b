#!/bin/bash

# parse args
section="${1-Main}"
file="${2-$HOME/.config/blezz/content}"
pattern="^\s*$section\s*:$"
shift 2

# environment
default_themestr='entry {placeholder:"Press hotkey";}'
ROFI_BLEZZ_THEMESTR="${ROFI_BLEZZ_THEMESTR-$default_themestr}"

# check args
usage="Usage: ${0##*/} [menu] [config] [rofi args]

    Run rofi in blezz mode with a different starting menu. The
    \$ROFI_BLEZZ_THEMESTR environment variable can be used to override
    rofi's theme on a per-setting basis. The default is
    '$default_themestr'.
"
if [[ "$section $file $*" == *--help* ]]; then
	echo "$usage" >&2
	exit
elif [[ ! -f "$file" ]]; then
	echo "Can't find or read file: $file" >&2
	exit 1
elif ! grep -q "$pattern" "$file"; then
	echo "Can't find section in $file: $section" >&2
	exit 1
fi

# run rofi with blezz module and modified config
rofi -show blezz -modi blezz -auto-select -matching normal -theme-str "$ROFI_BLEZZ_THEMESTR" "$@" -blezz-config <(
	sed -n "/$pattern/,$ p" "$file"
	sed -n "/$pattern/!p; /$pattern/q" "$file"
)

